<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"/><link href="../../../../bootstrap-combined.min.css" rel="stylesheet" /><script type="text/javascript" src="../../../../jquery-1.9.1.min.js"></script><script type="text/javascript" src="../../../../bootstrap.min.js"></script><link href="../../../../styles.css" rel="stylesheet" /><link rel="icon" href="../../../../favicon.ico" type="image/x-icon"></link><script type="text/javascript" src="../../../../nav.js"></script><script type="text/javascript" src="../../../../index.js"></script><script type="text/javascript">var dox = {rootPath: "../../../../",platforms: ["documentation"]};</script><title>TerrainGrid - Angle3D</title></head><body><div class="navbar navbar-inverse navbar-fixed-top"><div class="navbar-inner"><form class="navbar-search pull-left" id="searchForm"><input id="search" type="text" class="search-query" placeholder="Filter" autocomplete="off"/></form><ul class="nav"><li id="select-platform" class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Platform<b class="caret"></b></a><ul class="dropdown-menu"><li data="all"><a href="#">All Platforms</a></li><li data="documentation"><a href="#">documentation</a></li></ul></li></ul></div></div><div id="container"><div id="nav"></div><div id="content"><div class="header"><h1><code><span class="directive">class </span><span class="type">org.angle3d.terrain.geomipmap.TerrainGrid</span><span class="keyword"> extends</span> <a class="type" href="../../../../org/angle3d/terrain/geomipmap/TerrainQuad.html">TerrainQuad</a></code></h1></div><div class="body"><p class="availability">Available on all platforms</p><div class="doc"><p>
TerrainGrid itself is an actual TerrainQuad. Its four children are the visible four tiles.</p>
</p><p>
The grid is indexed by cells. Each cell has an integer XZ coordinate originating at 0,0.
TerrainGrid will piggyback on the TerrainLodControl so it can use the camera for its
updates as well. It does this in the overwritten update() method.
</p><p>
It uses an LRU (Least Recently Used) cache of 16 terrain tiles (full TerrainQuadTrees). The
center 4 are the ones that are visible. As the camera moves, it checks what camera cell it is in
and will attach the now visible tiles.
</p><p>
The 'quadIndex' variable is a 4x4 array that represents the tiles. The center
four (index numbers: 5, 6, 9, 10) are what is visible. Each quadIndex value is an
offset vector. The vector contains whole numbers and represents how many tiles in offset
this location is from the center of the map. So for example the index 11 [Vector3f(2, 0, 1)]
is located 2*terrainSize in X axis and 1*terrainSize in Z axis.
</p><p>
As the camera moves, it tests what cameraCell it is in. Each camera cell covers four quad tiles
and is half way inside each one.
</p><pre>
+-------+-------+
| 1     |     3 |    Four terrainQuads that make up the grid
|    *..|..*    |    with the cameraCell in the middle, covering
|----|--|--|----|    all four quads.
|    *..|..*    |
| 2     |     4 |
+-------+-------+
</pre><p>
This results in the effect of when the camera gets half way across one of the sides of a quad to
an empty (non-loaded) area, it will trigger the system to load in the next tiles.
</p><p>
The tile loading is done on a background thread, and once the tile is loaded, then it is
attached to the qrid quad tree, back on the OGL thread. It will grab the terrain quad from
the LRU cache if it exists. If it does not exist, it will load in the new TerrainQuad tile.
</p><p>
The loading of new tiles triggers events for any TerrainGridListeners. The events are:
<ul>
 <li>tile Attached
 <li>tile Detached
 <li>grid moved.
</ul>
<p>
These allow physics to update, and other operation (often needed for loading the terrain) to occur
at the right time.
</p></div><h2>Instance Fields</h2><div class="platform platform-documentation"><a name="cache"></a><h3><p><code><span class="keyword">var</span> <a href="#cache"><span class="identifier">cache</span></a>:<span class="type">ObjectMap</span>&lt;<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>, <a class="type" href="../../../../org/angle3d/terrain/geomipmap/TerrainQuad.html">TerrainQuad</a>&gt;</code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="cellsLoaded"></a><h3><p><code><span class="keyword">var</span> <a href="#cellsLoaded"><span class="identifier">cellsLoaded</span></a>:<span class="type">Int</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="currentCamCell"></a><h3><p><code><span class="keyword">var</span> <a href="#currentCamCell"><span class="identifier">currentCamCell</span></a>:<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="gridOffset"></a><h3><p><code><span class="keyword">var</span> <a href="#gridOffset"><span class="identifier">gridOffset</span></a>:<span class="type">Vector</span>&lt;<span class="type">Int</span>&gt;</code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="gridTileLoader"></a><h3><p><code><span class="keyword">var</span> <a href="#gridTileLoader"><span class="identifier">gridTileLoader</span></a>:<a class="type" href="../../../../org/angle3d/terrain/geomipmap/TerrainGridTileLoader.html">TerrainGridTileLoader</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="heightMapGrid"></a><h3><p><code><span class="keyword">var</span> <a href="#heightMapGrid"><span class="identifier">heightMapGrid</span></a>:<a class="type" href="../../../../org/angle3d/terrain/heightmap/HeightMapGrid.html">HeightMapGrid</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="listeners"></a><h3><p><code><span class="keyword">var</span> <a href="#listeners"><span class="identifier">listeners</span></a>:<span class="type">Array</span>&lt;<a class="type" href="../../../../org/angle3d/terrain/geomipmap/TerrainGridListener.html">TerrainGridListener</a>&gt;</code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="material"></a><h3><p><code><span class="keyword">var</span> <a href="#material"><span class="identifier">material</span></a>:<a class="type" href="../../../../org/angle3d/material/Material.html">Material</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="quadIndex"></a><h3><p><code><span class="keyword">var</span> <a href="#quadIndex"><span class="identifier">quadIndex</span></a>:<span class="type">Vector</span>&lt;<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>&gt;</code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="quadSize"></a><h3><p><code><span class="keyword">var</span> <a href="#quadSize"><span class="identifier">quadSize</span></a>:<span class="type">Int</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="quarterSize"></a><h3><p><code><span class="keyword">var</span> <a href="#quarterSize"><span class="identifier">quarterSize</span></a>:<span class="type">Int</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="runOnce"></a><h3><p><code><span class="keyword">var</span> <a href="#runOnce"><span class="identifier">runOnce</span></a>:<span class="type">Bool</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="new"></a><h3><p><code><span class="keyword">function</span> <a href="#new"><span class="identifier">new</span></a>(name:<span class="type">String</span>, patchSize:<span class="type">Int</span>, maxVisibleSize:<span class="type">Int</span>, scale:<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>, terrainQuadGrid:<a class="type" href="../../../../org/angle3d/terrain/geomipmap/TerrainGridTileLoader.html">TerrainGridTileLoader</a>, ?offset:<a class="type" href="../../../../org/angle3d/math/Vector2f.html">Vector2f</a>, ?offsetAmount:<span class="type">Float</span>):<span class="type">Void</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="addListener"></a><h3><p><code><span class="keyword">function</span> <a href="#addListener"><span class="identifier">addListener</span></a>(listener:<a class="type" href="../../../../org/angle3d/terrain/geomipmap/TerrainGridListener.html">TerrainGridListener</a>):<span class="type">Void</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="adjustHeights"></a><h3><p><code><span class="keyword">function</span> <a href="#adjustHeights"><span class="identifier">adjustHeights</span></a>(xz:<span class="type">Array</span>&lt;<a class="type" href="../../../../org/angle3d/math/Vector2f.html">Vector2f</a>&gt;, height:<span class="type">Vector</span>&lt;<span class="type">Float</span>&gt;):<span class="type">Void</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="attachQuadAt"></a><h3><p><code><span class="keyword">function</span> <a href="#attachQuadAt"><span class="identifier">attachQuadAt</span></a>(q:<a class="type" href="../../../../org/angle3d/terrain/geomipmap/TerrainQuad.html">TerrainQuad</a>, quadrant:<span class="type">Int</span>, quadCell:<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>, shifted:<span class="type">Bool</span>):<span class="type">Void</span></code></p></h3><div class="doc"><p>Runs on the rendering thread</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>shifted</td><td><p>quads are still attached to the parent and don't need to re-load</p></td></tr></tbody></table></div></div><div class="platform platform-documentation"><a name="getCamCell"></a><h3><p><code><span class="keyword">function</span> <a href="#getCamCell"><span class="identifier">getCamCell</span></a>(location:<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>):<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a></code></p></h3><div class="doc"><p>Get the location in cell-coordinates of the specified location.
Cell coordinates are integer corrdinates, usually with y=0, each 
representing a cell in the world.
For example, moving right in the +X direction:
(0,0,0) (1,0,0) (2,0,0), (3,0,0)
and then down the -Z direction:
(3,0,-1) (3,0,-2) (3,0,-3)</p></div></div><div class="platform platform-documentation"><a name="getCurrentCell"></a><h3><p><code><span class="keyword">function</span> <a href="#getCurrentCell"><span class="identifier">getCurrentCell</span></a>():<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="getGridTileLoader"></a><h3><p><code><span class="keyword">function</span> <a href="#getGridTileLoader"><span class="identifier">getGridTileLoader</span></a>():<a class="type" href="../../../../org/angle3d/terrain/geomipmap/TerrainGridTileLoader.html">TerrainGridTileLoader</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="getMaterialAt"></a><h3><p><code><span class="keyword">function</span> <a href="#getMaterialAt"><span class="identifier">getMaterialAt</span></a>(worldLocation:<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>):<a class="type" href="../../../../org/angle3d/material/Material.html">Material</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="getNumMajorSubdivisions"></a><h3><p><code><span class="keyword">function</span> <a href="#getNumMajorSubdivisions"><span class="identifier">getNumMajorSubdivisions</span></a>():<span class="type">Int</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="getQuadrantAt"></a><h3><p><code><span class="keyword">function</span> <a href="#getQuadrantAt"><span class="identifier">getQuadrantAt</span></a>(quadIndex:<span class="type">Int</span>):<span class="type">Int</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="getTerrainAt"></a><h3><p><code><span class="keyword">function</span> <a href="#getTerrainAt"><span class="identifier">getTerrainAt</span></a>(worldLocation:<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>):<a class="type" href="../../../../org/angle3d/terrain/Terrain.html">Terrain</a></code></p></h3><div class="doc"><p>Get the terrain tile at the specified world location, in XZ coordinates.</p></div></div><div class="platform platform-documentation"><a name="getTerrainAtCell"></a><h3><p><code><span class="keyword">function</span> <a href="#getTerrainAtCell"><span class="identifier">getTerrainAtCell</span></a>(cellCoordinate:<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>):<a class="type" href="../../../../org/angle3d/terrain/Terrain.html">Terrain</a></code></p></h3><div class="doc"><p>Get the terrain tile at the specified XZ cell coordinate (not world coordinate).</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>cellCoordinate</td><td><p>integer cell coordinates</p></td></tr><tr><td>returns</td><td><p>the terrain tile at that location</p></td></tr></tbody></table></div></div><div class="platform platform-documentation"><a name="getTileCell"></a><h3><p><code><span class="keyword">function</span> <a href="#getTileCell"><span class="identifier">getTileCell</span></a>(location:<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>):<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a></code></p></h3><div class="doc"><p>Centered at 0,0.
Get the tile index location in integer form:</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>location</td><td><p>world coordinate</p></td></tr></tbody></table></div></div><div class="platform platform-documentation"><a name="isCenter"></a><h3><p><code><span class="keyword">function</span> <a href="#isCenter"><span class="identifier">isCenter</span></a>(quadIndex:<span class="type">Int</span>):<span class="type">Bool</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="removeListener"></a><h3><p><code><span class="keyword">function</span> <a href="#removeListener"><span class="identifier">removeListener</span></a>(listener:<a class="type" href="../../../../org/angle3d/terrain/geomipmap/TerrainGridListener.html">TerrainGridListener</a>):<span class="type">Void</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="removeQuad"></a><h3><p><code><span class="keyword">function</span> <a href="#removeQuad"><span class="identifier">removeQuad</span></a>(q:<a class="type" href="../../../../org/angle3d/terrain/geomipmap/TerrainQuad.html">TerrainQuad</a>):<span class="type">Void</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="setMaterial"></a><h3><p><code><span class="keyword">function</span> <a href="#setMaterial"><span class="identifier">setMaterial</span></a>(material:<a class="type" href="../../../../org/angle3d/material/Material.html">Material</a>):<span class="type">Void</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="setQuadSize"></a><h3><p><code><span class="keyword">function</span> <a href="#setQuadSize"><span class="identifier">setQuadSize</span></a>(quadSize:<span class="type">Int</span>):<span class="type">Void</span></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-documentation"><a name="toCellSpace"></a><h3><p><code><span class="keyword">function</span> <a href="#toCellSpace"><span class="identifier">toCellSpace</span></a>(worldLocation:<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>):<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a></code></p></h3><div class="doc"><p>Convert the world location into a cell location (integer coordinates)</p></div></div><div class="platform platform-documentation"><a name="toWorldSpace"></a><h3><p><code><span class="keyword">function</span> <a href="#toWorldSpace"><span class="identifier">toWorldSpace</span></a>(cellLocation:<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>):<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a></code></p></h3><div class="doc"><p>Convert the cell coordinate (integer coordinates) into world coordinates.</p></div></div><div class="platform platform-documentation"><a name="updateChildren"></a><h3><p><code><span class="keyword">function</span> <a href="#updateChildren"><span class="identifier">updateChildren</span></a>(camCell:<a class="type" href="../../../../org/angle3d/math/Vector3f.html">Vector3f</a>):<span class="type">Void</span></code></p></h3><div class="doc"><p>Called when the camera has moved into a new cell. We need to
update what quads are in the scene now.</p>
<p>Step 1: touch cache
LRU cache is used, so elements that need to remain
should be touched.</p>
<p>Step 2: load new quads in background thread
if the camera has moved into a new cell, we load in new quads</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>camCell</td><td><p>the cell the camera is in</p></td></tr></tbody></table></div></div></div></div></div></body></html>